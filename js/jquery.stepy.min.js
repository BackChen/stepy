(function(e){e.fn.stepy=function(j){options=e.extend({},e.fn.stepy.defaults,j);if(this.attr("id")===undefined){a("Invalid selector!");return;}$this=e(this);var h=$this.attr("id"),o=$this.find("fieldset"),n=o.size(),i=options.validate,p="",r="";$this.before('<ul id="'+h+'-titles" class="titles"></ul>');if(d(h)&&i){$this.append('<div class="error-step"></div>');}o.each(function(s){e(this).attr("id",h+"-step-"+s).append('<p id="'+h+"-buttons-"+s+'"></p>').addClass("step");r=e(this).children("legend:first").html();p=(e(this).attr("title")!="")?e(this).attr("title"):"--";e("ul#"+h+"-titles").append('<li id="'+h+"-title-"+s+'">'+p+"<span>"+r+"</span></li>");if(s==0){k(s);}else{if(s==(n-1)){l(s);e("fieldset#"+h+"-step-"+s).hide();}else{l(s);k(s);e("fieldset#"+h+"-step-"+s).hide();}}});e("li#"+h+"-title-0").addClass("current-step");var q=e("#"+h+" .finish");if(q[0]){if(options.includeFinish){q=q.removeClass("finish").addClass("button-finish").hide().appendTo("p#"+h+"-buttons-"+(n-1));}}else{if(d(h)){a('You should create a button with a class named "finish" when the attribute includeFinish is true.');}}function m(t){var s=e("ul#"+t+"-titles").find("li.current-step").attr("id").split("-");return parseInt(s[s.length-1]);}function g(t){var s=t.attr("id").split("-");return parseInt(s[s.length-1]);}if(options.titleClick){e("li",e("ul#"+h+"-titles")[0]).live("click",function(){var u=m(h),t=g(e(this));if(t==u){return false;}var s=t,v=true;if(i){e("fieldset.step",e("#"+h)[0]).each(function(w){if(w>=t){return false;}if(t>u){v=f(h,w)&&v;if(!v){s=w;return false;}}});}if(s!=u){b(h,s);if(s+1==n){q.show();}}});}function l(s){var t=h+"-back-"+s;e("p#"+h+"-buttons-"+s).append('<a id="'+t+'" href="javascript:void(0);" class="button-back">'+options.backLabel+"</a>");e("a#"+t).live("click",function(){b(h,s-1);q.hide();});}function k(s){var t=h+"-next-"+s;e("p#"+h+"-buttons-"+s).append('<a id="'+t+'" href="javascript:void(0);" class="button-next">'+options.nextLabel+"</a>");e("a#"+t).live("click",function(){if(!i||f(h,s)){b(h,s+1);if(s+2==n){q.show();}}});}return $this;};e.fn.stepy.defaults={backLabel:"&lt; Back",includeFinish:true,nextLabel:"Next &gt;",titleClick:true,validate:false};e.fn.stepy.step=function(g,h){e("p#"+c(h)+"-buttons-"+(g-2)+" a.button-next").trigger("click");};function c(g){if(g){if(e("#"+g)[0]){return g;}else{a("Invalid selector of the public funtion $.fn.stepy.step()!");}}else{return $this.attr("id");}}function b(i,g){var h=e("#"+i+" fieldset").size();if(g>h){g=h-1;}e("#"+i+" fieldset.step").hide();e("#"+i+" fieldset#"+i+"-step-"+g).show();e("ul#"+i+"-titles li").removeClass("current-step");e("li#"+i+"-title-"+g).addClass("current-step");if(d(i)){e(":input:visible",e("#"+i+" fieldset#"+i+"-step-"+g)[0]).each(function(){if(!e(this).attr("disabled")){e(this).focus();return false;}});}}function d(h){var g=e("#"+h).get().toString();if(g==="[object HTMLFormElement]"){return true;}return false;}function f(j,h){if(!d(j)){return true;}var i=true,g=e("#"+j);e("#"+j+" div.error-step").html("");e(":input",e("#"+j+" fieldset#"+j+"-step-"+h)[0]).each(function(){i=i&&g.validate().element(e(this));if(i===undefined){i=true;}if(i||i===undefined){b(j,h);}else{g.validate().focusInvalid();i=false;}});return i;}function a(g){if(window.console&&window.console.log){window.console.log(g);}}})(jQuery);